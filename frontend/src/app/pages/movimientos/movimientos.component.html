<div class="movimientos-container">
  <h2>Movimientos</h2>
  <form [formGroup]="movimientoForm" (ngSubmit)="agregarMovimiento()">
    <div>
      <label>Monto</label>
      <input type="number" formControlName="monto" required />
      <div *ngIf="movimientoForm.get('monto')?.invalid && movimientoForm.get('monto')?.touched" class="error">
        El monto es obligatorio y debe ser mayor a 0.
      </div>
    </div>
    <div>
      <label>Tipo</label>
      <select formControlName="tipo">
        <option value="INGRESO">Ingreso</option>
        <option value="GASTO">Gasto</option>
      </select>
      <div *ngIf="movimientoForm.get('tipo')?.invalid && movimientoForm.get('tipo')?.touched" class="error">
        El tipo es obligatorio.
      </div>
    </div>
    <div>
      <label>Descripción</label>
      <input formControlName="descripcion" required />
      <div *ngIf="movimientoForm.get('descripcion')?.invalid && movimientoForm.get('descripcion')?.touched" class="error">
        La descripción es obligatoria.
      </div>
    </div>
    <div>
      <label>Categoría</label>
      <select formControlName="categoria">
        <option *ngFor="let cat of categorias" [ngValue]="cat">{{ cat.nombre }}</option>
      </select>
      <div *ngIf="movimientoForm.get('categoria')?.invalid && movimientoForm.get('categoria')?.touched" class="error">
        La categoría es obligatoria.
      </div>
    </div>
    <button type="submit" [disabled]="movimientoForm.invalid || cargando">
      <span *ngIf="cargando" class="spinner"></span>
      Agregar
    </button>
    <div class="success" *ngIf="success">{{ success }}</div>
    <div class="error" *ngIf="error">{{ error }}</div>
  </form>
  <div *ngIf="loading">Cargando movimientos...</div>
  <table *ngIf="!loading && movimientos.length > 0">
    <thead>
      <tr>
        <th>Monto</th>
        <th>Tipo</th>
        <th>Descripción</th>
        <th>Categoría</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let mov of movimientos">
        <td>{{ mov.monto }}</td>
        <td>{{ mov.tipo }}</td>
        <td>{{ mov.descripcion }}</td>
        <td>{{ mov.categoria?.nombre }}</td>
      </tr>
    </tbody>
  </table>
  <div *ngIf="!loading && movimientos.length === 0" class="info">No hay movimientos registrados.</div>
</div>